import{o as p,e as L,a as o,g as Y,t as w,n as W,d as n,p as de,q as pe,c as E,w as x,u as a,b as i,f as me,l as C,v as N,s as B,h as I,F as K,x as d,m as ve,O as M}from"./app-cfec5476.js";import{t as G,a as J,l as g,m as fe,v as q,n as A,i as be,u as R,y as ge}from"./pin-79e6f3d9.js";import{_ as he,a as ye}from"./AppLayout-021db77d.js";const _e={class:"modal-box"},xe={class:"font-bold text-lg"},we={class:"font-bold text-blue-500"},ke={class:"py-4"},je={class:"modal-action"},Be={__name:"LakeModal",props:{selectedAreaName:{type:String,required:!0},showModal:{type:Boolean,required:!0}},setup(h){return(m,u)=>(p(),L("div",{class:W(["modal",{"modal-open":h.showModal}])},[o("div",_e,[o("h3",xe,[Y(w(m.$t("You have chosen"))+" ",1),o("span",we,w(h.selectedAreaName),1)]),o("p",ke,w(m.$t("Now set the marker of your observation by clicking on the map")),1),o("div",je,[o("button",{class:"btn",onClick:u[0]||(u[0]=y=>m.$emit("update:showModal",!1))}," Ok ")])])],2))}},Le={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Se={class:"relative",style:{height:"calc(100vh - 188px)",width:"100%"}},$e={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-primary opacity-80 z-10"},Ee={class:"spinner z-50"},Ce={class:"loader"},Ne={class:"loader-bg"},Me={class:"flex items-center justify-center"},Ae=o("div",{class:"drops"},[o("div",{class:"drop1"}),o("div",{class:"drop2"})],-1),Oe=o("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},[o("defs",null,[o("filter",{id:"liquid"},[o("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),o("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"liquid"})])])],-1),ze={class:"text-white flex items-center justify-center text-2xl font-semibold"},Te={class:"checkbox-container"},Ue={class:"join space-x-1"},Ve={class:"label cursor-pointer"},De=o("span",{class:"label-text mr-1"},"J채rved",-1),Pe={class:"label cursor-pointer"},Ze=o("span",{class:"label-text mr-1"},"Vooluveekogud",-1),Fe={class:"label cursor-pointer"},Ie=o("span",{class:"label-text mr-1"},"Karstij채rvikud",-1),Ke=o("h3",{class:"font-bold text-lg"},"Please select a water source first",-1),Ye={__name:"Dashboard",props:{observation_spots:Object,title:String,main_map:Boolean},setup(h){const m=h,u=n(null),y=n(4),H=n([55.615,-50.09]);n(!0),n(!0),n(!0),n(!1);let O=n(""),k=n(!1),_=n(!1),v=n(!1),f=n(!1),b=n(!1);function Q(){k.value=!k.value}function X(t){return{fillColor:"blue",color:"white",weight:2,opacity:1,fillOpacity:.7}}function ee(t){return{fillColor:"red",color:"white",weight:2,opacity:1,fillOpacity:.7}}function te(t){return{fillColor:"green",color:"white",weight:2,opacity:1,fillOpacity:.7}}let oe=n(!1),l=null,z=n(!1);const S=(t,e)=>{e.on("click",()=>{l&&l.setStyle({weight:3,color:"#3388ff"}),O=t.properties.nimi,e.setStyle({weight:5,color:"red"}),_.value=!0,console.log("show modal"),l=e,s.openTooltip()});const s=e.bindTooltip(t.properties.nimi,{permanent:!1,direction:"center",className:"my-tooltip"})};let T=n(!0),U=G(58.789,24.554),se=J([60.4349,29.4338],[56.7458,20.373]),V=[],r=null;function ae(){console.log("map ready"),r=u.value.leafletObject}const D=g.icon({iconUrl:fe,iconSize:[55,55],iconAnchor:[25,55],popupAnchor:[0,-55],className:"marker-icon"});function ne(t){if(!l){k.value=!0;return}if(t.originalEvent.target.classList.contains("leaflet-interactive"))return;const e=t.latlng,s=g.marker(e,{icon:D}),c=g.popup().setContent(`
      <p class="mb-2 text-lg font-semibold text-gray-900">${d("Add new observation spot?")}</p>
      <div class="flex space-x-2">
        <button id="yesButton" class="px-4 py-2 btn btn-primary">${d("Yes")}</button>
        <button id="noButton" class="px-4 py-2 btn">${d("No")}</button>
      </div>
    `);s.bindPopup(c),ve(()=>{r.invalidateSize(),r.addLayer(s),s.openPopup(),document.getElementById("yesButton").addEventListener("click",()=>{V.push(t.latlng),ie(t.latlng)}),document.getElementById("noButton").addEventListener("click",()=>{r.removeLayer(s),l&&(l.setStyle({weight:2,color:"#3388ff"}),l=null)}),r.on("popupclose",()=>{r.removeLayer(s)})})}function le(t){const e=`
      <h2 class="mb-2 text-lg font-semibold text-gray-900">${t.name}</h2>
      <p class="mb-2 text-md text-gray-900">${d("Add a new observation?")}</p>
      <div class="flex space-x-2">
          <div class="join">
            <button id="yesButton" class="px-4 py-2 btn join-item btn-primary">${d("Yes")}</button>
            <button id="noButton" class="px-4 py-2 btn join-item btn-error">${d("No")}</button>
           </div>
           <button id="viewButton" class="px-4 py-2 btn btn-secondary">${d("View")}</button>

      </div>
    `;g.popup().setLatLng([t.latitude,t.longitude]).setContent(e).openOn(r),document.getElementById("yesButton").addEventListener("click",()=>{re(t.id)}),document.getElementById("noButton").addEventListener("click",()=>{r.closePopup()}),document.getElementById("viewButton").addEventListener("click",()=>{M.get(`/observation-spots/${t.id}`)})}function ie(t){if(console.log("add new spot and observation"),l){const e=JSON.stringify(t),s=l.feature.properties.nimi,c=l.feature.properties.kr_kood,j=null;M.get(`/observations/create?coordinates=${e}&name=${s}&water_body_kr_code=${c}&observation_spot_id=${j}`)}}function re(t){console.log("add new observation"),M.get(`/observations/create?observation_spot_id=${t}`)}var P=null,Z=null,F=null;let $=n("Laen j채rved...");var ce=new g.Proj.CRS("EPSG:3301","+proj=lcc +lat_1=59.33333333333334 +lat_2=58 +lat_0=57.51755393055556 +lon_0=24 +x_0=500000 +y_0=6375000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",{resolutions:[4e3,2e3,1e3,500,250,125,62.5,31.25,15.625,7.8125,3.90625,1.953125,.9765625,.48828125,.244140625,.122070313,.061035156,.030517578,.015258789],origin:[40500,5993e3],bounds:g.bounds([40500,5993e3],[1064500,7017e3])});let ue=J([57.522,21.77],[59.674,28.209]);return de(async()=>{const t=await caches.open("geojson-cache");let e=await t.match("/geojson/jarved");e||(e=await fetch("/geojson/jarved"),t.put("/geojson/jarved",e.clone()));let s=await e.json();$.value="Laen vooluveekogud...",P=s,e=await t.match("/geojson/vooluvesi"),e||(e=await fetch("/geojson/vooluvesi"),t.put("/geojson/vooluvesi",e.clone())),s=await e.json(),$.value="Laen karstij채rvikud...",Z=s,e=await t.match("/geojson/karst"),e||(e=await fetch("/geojson/karst"),t.put("/geojson/karst",e.clone())),s=await e.json(),F=s,oe.value=!0,z.value=!0,v.value=!0,f.value=!0,b.value=!0}),navigator.geolocation&&m.main_map&&navigator.geolocation.getCurrentPosition(t=>{let e=G(t.coords.latitude,t.coords.longitude);ue.contains(e)&&(U=e,y.value=9)},t=>{console.error("Error obtaining geolocation: ",t)}),pe([H,y],([t,e])=>{u.value&&(u.value={center:t,zoom:e})}),(t,e)=>(p(),E(he,{title:t.$t("Main map")},{header:x(()=>[o("h2",Le,w(t.$t(h.title)),1)]),default:x(()=>[o("main",Se,[a(z)?me("",!0):(p(),L("div",$e,[o("div",Ee,[o("div",Ce,[o("div",Ne,[o("span",Me,[i(ye,{class:"w-20 mt-4 h-20 fill-white"})])]),Ae]),Oe,o("p",ze,w(a($)),1)])])),o("div",Te,[o("div",Ue,[o("label",Ve,[De,C(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>B(v)?v.value=s:v=s)},null,512),[[N,a(v)]])]),o("label",Pe,[Ze,C(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>B(f)?f.value=s:f=s)},null,512),[[N,a(f)]])]),o("label",Fe,[Ie,C(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>B(b)?b.value=s:b=s)},null,512),[[N,a(b)]])])])]),i(a(be),{ref_key:"map",ref:u,crs:a(ce),zoom:y.value,"onUpdate:zoom":e[3]||(e[3]=s=>y.value=s),useGlobalLeaflet:!0,center:a(U),bounds:a(se),maxZoom:14,minZoom:3,scrollWheelZoom:!0,onClick:ne,onReady:ae},{default:x(()=>[i(a(q),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/vreljeef/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",tms:a(T),"full-screen":!1,worldCopyJump:!0,"z-index":1,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(a(q),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/hybriid/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",attribution:"Maa-ameti kaart, <a href='http://www.maaamet.ee'>Maa-amet</a>",tms:a(T),"full-screen":!1,worldCopyJump:!0,"z-index":2,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(a(A),{visible:a(v),options:{style:X,onEachFeature:S},geojson:a(P)},null,8,["visible","options","geojson"]),i(a(A),{visible:a(f),options:{style:ee,onEachFeature:S},geojson:a(Z)},null,8,["visible","options","geojson"]),i(a(A),{visible:a(b),options:{style:te,onEachFeature:S},geojson:a(F)},null,8,["visible","options","geojson"]),(p(!0),L(K,null,I(a(V),(s,c)=>(p(),E(a(R),{key:c,"lat-lng":s},{default:x(()=>[i(a(ge),{ref_for:!0,ref:"popup"},{default:x(()=>[Y(" Popup content ")]),_:1},512)]),_:2},1032,["lat-lng"]))),128)),(p(!0),L(K,null,I(a(m).observation_spots.data,(s,c)=>(p(),E(a(R),{key:c,"lat-lng":[s.latitude,s.longitude],icon:a(D),onClick:j=>le(s)},null,8,["lat-lng","icon","onClick"]))),128))]),_:1},8,["crs","zoom","center","bounds"]),i(Be,{showModal:a(_),selectedAreaName:a(O),"onUpdate:showModal":e[4]||(e[4]=s=>B(_)?_.value=s:_=s)},null,8,["showModal","selectedAreaName"]),o("div",{class:W(["modal",{"modal-open":a(k)}])},[o("div",{class:"modal-box"},[Ke,o("div",{class:"modal-action"},[o("button",{class:"btn",onClick:Q}," Ok ")])])],2)])]),_:1},8,["title"]))}};export{Ye as default};
