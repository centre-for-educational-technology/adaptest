import{t as D,a as P,l as m,m as ne,v as U,n as B,i as se,u as I,y as le}from"./pin-48ce80cb.js";import{_ as ie,a as re}from"./AppLayout-6ed40c1b.js";import{o as u,e as w,a as n,g as G,t as E,n as K,d as s,p as ce,q as de,c as L,w as g,u as o,b as i,f as ue,h as Z,F,s as me,m as pe,O as S}from"./app-10f60e12.js";const ve={class:"modal-box"},fe={class:"font-bold text-lg"},ge={class:"font-bold text-blue-500"},be=n("p",{class:"py-4"},"Now set the marker of your observation by clicking on the map",-1),he={class:"modal-action"},ye={__name:"LakeModal",props:{selectedAreaName:{type:String,required:!0},showModal:{type:Boolean,required:!0}},setup(p){return(b,c)=>(u(),w("div",{class:K(["modal",{"modal-open":p.showModal}])},[n("div",ve,[n("h3",fe,[G("You have chosen "),n("span",ge,E(p.selectedAreaName),1)]),be,n("div",he,[n("button",{class:"btn",onClick:c[0]||(c[0]=v=>b.$emit("update:showModal",!1))}," Ok ")])])],2))}},_e={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},we={class:"relative",style:{height:"calc(100vh - 188px)",width:"100%"}},xe={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-primary opacity-80 z-10"},ke={class:"spinner z-50"},je={class:"loader"},Be={class:"loader-bg"},Le={class:"flex items-center justify-center"},Se=n("div",{class:"drops"},[n("div",{class:"drop1"}),n("div",{class:"drop2"})],-1),Ee=n("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},[n("defs",null,[n("filter",{id:"liquid"},[n("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),n("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"liquid"})])])],-1),Ce={class:"text-white flex items-center justify-center text-2xl font-semibold"},Ne=n("h3",{class:"font-bold text-lg"},"Please select a water source first",-1),ze={__name:"Dashboard",props:{observation_spots:Object,title:String,main_map:Boolean},setup(p){const b=p,c=s(null),v=s(4),q=s([55.615,-50.09]);s(!0),s(!0),s(!0),s(!1);let C=s(""),h=s(!1),f=s(!1);function J(){h.value=!h.value}function R(e){return{fillColor:"blue",color:"white",weight:2,opacity:1,fillOpacity:.7}}function V(e){return{fillColor:"red",color:"white",weight:2,opacity:1,fillOpacity:.7}}function Y(e){return{fillColor:"green",color:"white",weight:2,opacity:1,fillOpacity:.7}}let y=s(!1),d=null,N=s(!1);const x=(e,t)=>{t.on("click",()=>{d&&d.setStyle({weight:3,color:"#3388ff"}),C=e.properties.nimi,t.setStyle({weight:5,color:"red"}),f.value=!0,console.log("show modal"),d=t,a.openTooltip()});const a=t.bindTooltip(e.properties.nimi,{permanent:!1,direction:"center",className:"my-tooltip"})};let $=s(!0),k=D(58.789,24.554),W=P([60.4349,29.4338],[56.7458,20.373]),A=[],l=null;function H(){console.log("map ready"),l=c.value.leafletObject}const M=m.icon({iconUrl:ne,iconSize:[55,55],iconAnchor:[25,55],popupAnchor:[0,-55],className:"marker-icon"});function Q(e){if(!d){h.value=!0;return}if(e.originalEvent.target.classList.contains("leaflet-interactive"))return;const t=e.latlng,a=m.marker(t,{icon:M}),r=m.popup().setContent(`
      <p class="mb-2 text-lg font-semibold text-gray-900">Add a new observation spot?</p>
      <div class="flex space-x-2">
        <button id="yesButton" class="px-4 py-2 btn btn-primary">Yes</button>
        <button id="noButton" class="px-4 py-2 btn">No</button>
      </div>
    `);a.bindPopup(r),pe(()=>{l.invalidateSize(),l.addLayer(a),a.openPopup(),document.getElementById("yesButton").addEventListener("click",()=>{A.push(e.latlng),ee(e.latlng)}),document.getElementById("noButton").addEventListener("click",()=>{l.removeLayer(a)}),l.on("popupclose",()=>{l.removeLayer(a)})})}function X(e){console.log("mapInstance:",l);const t=`
      <h2 class="mb-2 text-lg font-semibold text-gray-900">${e.name}</h2>
      <p class="mb-2 text-md text-gray-900">Add a new observation?</p>
      <div class="flex space-x-2">
          <div class="join">
            <button id="yesButton" class="px-4 py-2 btn join-item btn-primary">Yes</button>
            <button id="noButton" class="px-4 py-2 btn join-item btn-error">No</button>
           </div>
           <button id="viewButton" class="px-4 py-2 btn btn-secondary">View</button>

      </div>
    `;m.popup().setLatLng([e.latitude,e.longitude]).setContent(t).openOn(l),document.getElementById("yesButton").addEventListener("click",()=>{te(e.id)}),document.getElementById("noButton").addEventListener("click",()=>{l.closePopup()}),document.getElementById("viewButton").addEventListener("click",()=>{S.get(`/observation-spots/${e.id}`)})}function ee(e){if(console.log("add new spot and observation"),d){const t=JSON.stringify(e),a=d.feature.properties.nimi,r=d.feature.properties.kr_kood,_=null;S.get(`/observations/create?coordinates=${t}&name=${a}&water_body_kr_code=${r}&observation_spot_id=${_}`)}}function te(e){console.log("add new observation"),S.get(`/observations/create?observation_spot_id=${e}`)}var O=null,z=null,T=null;let j=s("Laen järved...");var oe=new m.Proj.CRS("EPSG:3301","+proj=lcc +lat_1=59.33333333333334 +lat_2=58 +lat_0=57.51755393055556 +lon_0=24 +x_0=500000 +y_0=6375000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",{resolutions:[4e3,2e3,1e3,500,250,125,62.5,31.25,15.625,7.8125,3.90625,1.953125,.9765625,.48828125,.244140625,.122070313,.061035156,.030517578,.015258789],origin:[40500,5993e3],bounds:m.bounds([40500,5993e3],[1064500,7017e3])});let ae=P([57.522,21.77],[59.674,28.209]);return ce(async()=>{const e=await caches.open("geojson-cache");let t=await e.match("/geojson/jarved");t||(t=await fetch("/geojson/jarved"),e.put("/geojson/jarved",t.clone()));let a=await t.json();j.value="Laen vooluveekogud...",O=a,t=await e.match("/geojson/vooluvesi"),t||(t=await fetch("/geojson/vooluvesi"),e.put("/geojson/vooluvesi",t.clone())),a=await t.json(),j.value="Laen karstijärvikud...",z=a,t=await e.match("/geojson/karst"),t||(t=await fetch("/geojson/karst"),e.put("/geojson/karst",t.clone())),a=await t.json(),T=a,y.value=!0,N.value=!0}),navigator.geolocation&&b.main_map&&navigator.geolocation.getCurrentPosition(e=>{let t=D(e.coords.latitude,e.coords.longitude);ae.contains(t)&&(k=t,console.log("maaametCenter:",k),v.value=9)},e=>{console.error("Error obtaining geolocation: ",e)}),de([q,v],([e,t])=>{c.value&&(c.value={center:e,zoom:t})}),(e,t)=>(u(),L(ie,{title:e.$t("Main map")},{header:g(()=>[n("h2",_e,E(e.$t(p.title)),1)]),default:g(()=>[n("main",we,[o(N)?ue("",!0):(u(),w("div",xe,[n("div",ke,[n("div",je,[n("div",Be,[n("span",Le,[i(re,{class:"w-20 mt-4 h-20 fill-white"})])]),Se]),Ee,n("p",Ce,E(o(j)),1)])])),i(o(se),{ref_key:"map",ref:c,crs:o(oe),zoom:v.value,"onUpdate:zoom":t[0]||(t[0]=a=>v.value=a),useGlobalLeaflet:!0,center:o(k),bounds:o(W),maxZoom:14,minZoom:3,scrollWheelZoom:!0,onClick:Q,onReady:H},{default:g(()=>[i(o(U),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/vreljeef/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",tms:o($),"full-screen":!1,worldCopyJump:!0,"z-index":1,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(o(U),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/hybriid/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",attribution:"Maa-ameti kaart, <a href='http://www.maaamet.ee'>Maa-amet</a>",tms:o($),"full-screen":!1,worldCopyJump:!0,"z-index":2,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(o(B),{visible:o(y),options:{style:R,onEachFeature:x},geojson:o(O)},null,8,["visible","options","geojson"]),i(o(B),{visible:o(y),options:{style:V,onEachFeature:x},geojson:o(z)},null,8,["visible","options","geojson"]),i(o(B),{visible:o(y),options:{style:Y,onEachFeature:x},geojson:o(T)},null,8,["visible","options","geojson"]),(u(!0),w(F,null,Z(o(A),(a,r)=>(u(),L(o(I),{key:r,"lat-lng":a},{default:g(()=>[i(o(le),{ref_for:!0,ref:"popup"},{default:g(()=>[G(" Popup content ")]),_:1},512)]),_:2},1032,["lat-lng"]))),128)),(u(!0),w(F,null,Z(o(b).observation_spots.data,(a,r)=>(u(),L(o(I),{key:r,"lat-lng":[a.latitude,a.longitude],icon:o(M),onClick:_=>X(a)},null,8,["lat-lng","icon","onClick"]))),128))]),_:1},8,["crs","zoom","center","bounds"]),i(ye,{showModal:o(f),selectedAreaName:o(C),"onUpdate:showModal":t[1]||(t[1]=a=>me(f)?f.value=a:f=a)},null,8,["showModal","selectedAreaName"]),n("div",{class:K(["modal",{"modal-open":o(h)}])},[n("div",{class:"modal-box"},[Ne,n("div",{class:"modal-action"},[n("button",{class:"btn",onClick:J}," Ok ")])])],2)])]),_:1},8,["title"]))}};export{ze as default};
