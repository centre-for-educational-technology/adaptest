import{o as b,e as V,a as o,g as ae,t as L,n as D,d as l,p as _,k as ye,q as _e,m as H,c as A,w as j,u as s,b as k,f as ke,l as I,v as z,s as B,h as Q,F as X,x as f,O as U}from"./app-efece314.js";import{t as J,a as ee,l as m,m as we,v as te,i as xe,u as oe,y as Se}from"./pin-a80ebc09.js";import{_ as je,a as Be}from"./AppLayout-2363e21b.js";const Le={class:"modal-box"},Ee={class:"font-bold text-lg"},$e={class:"font-bold text-blue-500"},Ce={class:"py-4"},Ne={class:"modal-action"},Oe={__name:"LakeModal",props:{selectedAreaName:{type:String,required:!0},showModal:{type:Boolean,required:!0}},setup(w){return(g,p)=>(b(),V("div",{class:D(["modal",{"modal-open":w.showModal}])},[o("div",Le,[o("h3",Ee,[ae(L(g.$t("You have chosen"))+" ",1),o("span",$e,L(w.selectedAreaName),1)]),o("p",Ce,L(g.$t("Now set the marker of your observation by clicking on the map")),1),o("div",Ne,[o("button",{class:"btn",onClick:p[0]||(p[0]=v=>g.$emit("update:showModal",!1))}," Ok ")])])],2))}},Ve={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Me={class:"relative",style:{height:"calc(100vh - 188px)",width:"100%"}},Te={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-primary opacity-80 z-10"},Ae={class:"spinner z-50"},Ie={class:"loader"},ze={class:"loader-bg"},Ue={class:"flex items-center justify-center"},Je=o("div",{class:"drops"},[o("div",{class:"drop1"}),o("div",{class:"drop2"})],-1),De=o("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},[o("defs",null,[o("filter",{id:"liquid"},[o("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),o("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"liquid"})])])],-1),Pe={class:"text-white flex items-center justify-center text-2xl font-semibold"},Ze={class:"checkbox-container"},Fe={class:"lg:join lg:space-x-1"},Ke={class:"label cursor-pointer"},Ge=o("span",{class:"label-text mr-1"},"J채rved",-1),qe={class:"label cursor-pointer"},Re=o("span",{class:"label-text mr-1"},"Vooluveekogud",-1),Ye={class:"label cursor-pointer"},We=o("span",{class:"label-text mr-1"},"Karstij채rvikud",-1),He=o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})],-1),Qe=[He],Xe=o("h3",{class:"font-bold text-lg"},"Please select a water source first",-1),et={class:"modal-box"},tt=o("h3",{class:"font-bold text-lg"},"You are outside of Estonia",-1),ot={class:"modal-action"},it={__name:"Dashboard",props:{observation_spots:Object,title:String,main_map:Boolean},setup(w){const g=w,p=l(null),v=l(4),se=l([55.615,-50.09]);l(!0),l(!0),l(!0),l(!1);let P=l(""),E=l(!1),x=l(!1),S=l(!1),c=l(!1),u=l(!1),d=l(!1),h=null,$=null,C=null;const le=()=>{localStorage.setItem("isJarvedVisible",c.value),localStorage.setItem("isVooluvesiVisible",u.value),localStorage.setItem("isKarstVisible",d.value)};_([c,u,d],()=>{le()});const ne=()=>{N.value="Laen geolokatsiooni...",y.value=!1,navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t=J(e.coords.latitude,e.coords.longitude);W.contains(t)?(T.value=t,v.value=9):S.value=!0,y.value=!0},e=>{console.error("Error obtaining geolocation: ",e),y.value=!0}):(console.error("Geolocation is not supported by this browser."),y.value=!0)};function ie(){E.value=!E.value}let re=ye(()=>v.value>=7?15:2);function ce(e){return{fillColor:"#00B1F6",color:"#00B1F6",weight:2,opacity:1,fillOpacity:.6}}function Z(e){return{fillColor:"#00b5ff",color:"#00b5ff",weight:re.value,opacity:1,fillOpacity:.7}}function ue(e){return{fillColor:"#006891",color:"#006891",weight:2,opacity:1,fillOpacity:.7}}let de=l(!1),r=null,y=l(!1);const M=(e,t)=>{t.on("click",()=>{r&&r.setStyle({weight:3,color:"#006891"}),P=e.properties.nimi,t.setStyle({weight:5,color:"#ff5861"}),x.value=!0,console.log("show modal"),r=t,a.openTooltip()});const a=t.bindTooltip(e.properties.nimi,{permanent:!1,direction:"center",className:"my-tooltip"})};let F=l(!0),T=J(58.789,24.554),me=ee([60.4349,29.4338],[56.7458,20.373]),K=[],n=null;function pe(){console.log("map ready"),n=p.value.leafletObject}const G=m.icon({iconUrl:we,iconSize:[55,55],iconAnchor:[25,55],popupAnchor:[0,-55],className:"marker-icon"});function ve(e){if(!r){E.value=!0;return}if(e.originalEvent.target.classList.contains("leaflet-interactive"))return;const t=e.latlng,a=m.marker(t,{icon:G}),i=m.popup().setContent(`
      <p class="mb-2 text-lg font-semibold text-gray-900">${f("Add new observation spot?")}</p>
      <div class="flex space-x-2">
        <button id="yesButton" class="px-4 py-2 btn btn-primary">${f("Yes")}</button>
        <button id="noButton" class="px-4 py-2 btn">${f("No")}</button>
      </div>
    `);a.bindPopup(i),H(()=>{n.invalidateSize(),n.addLayer(a),a.openPopup(),document.getElementById("yesButton").addEventListener("click",()=>{K.push(e.latlng),be(e.latlng)}),document.getElementById("noButton").addEventListener("click",()=>{n.removeLayer(a),r&&(r.setStyle({weight:2,color:"#006891"}),r=null)}),n.on("popupclose",()=>{n.removeLayer(a)})})}function fe(e){const t=`
      <h2 class="mb-2 text-lg font-semibold text-gray-900">${e.name}</h2>
      <p class="mb-2 text-md text-gray-900">${f("Add a new observation?")}</p>
      <div class="flex space-x-2">
          <div class="join">
            <button id="yesButton" class="px-4 py-2 btn join-item btn-primary">${f("Yes")}</button>
            <button id="noButton" class="px-4 py-2 btn join-item btn-error">${f("No")}</button>
           </div>
           <button id="viewButton" class="px-4 py-2 btn btn-secondary">${f("View")}</button>

      </div>
    `;m.popup().setLatLng([e.latitude,e.longitude]).setContent(t).openOn(n),document.getElementById("yesButton").addEventListener("click",()=>{ge(e.id)}),document.getElementById("noButton").addEventListener("click",()=>{n.closePopup()}),document.getElementById("viewButton").addEventListener("click",()=>{U.get(`/observation-spots/${e.id}`)})}function be(e){if(console.log("add new spot and observation"),r){const t=JSON.stringify(e),a=r.feature.properties.nimi,i=r.feature.properties.kr_kood,O=null;U.get(`/observations/create?coordinates=${t}&name=${a}&water_body_kr_code=${i}&observation_spot_id=${O}`)}}function ge(e){console.log("add new observation"),U.get(`/observations/create?observation_spot_id=${e}`)}var q=null,R=null,Y=null;let N=l("Laen j채rved...");var he=new m.Proj.CRS("EPSG:3301","+proj=lcc +lat_1=59.33333333333334 +lat_2=58 +lat_0=57.51755393055556 +lon_0=24 +x_0=500000 +y_0=6375000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",{resolutions:[4e3,2e3,1e3,500,250,125,62.5,31.25,15.625,7.8125,3.90625,1.953125,.9765625,.48828125,.244140625,.122070313,.061035156,.030517578,.015258789],origin:[40500,5993e3],bounds:m.bounds([40500,5993e3],[1064500,7017e3])});let W=ee([57.522,21.77],[59.674,28.209]);return _e(async()=>{await H();const e=await caches.open("geojson-cache");let t=await e.match("/geojson/jarved");t||(t=await fetch("/geojson/jarved"),e.put("/geojson/jarved",t.clone()));let a=await t.json();N.value="Laen vooluveekogud...",q=a,t=await e.match("/geojson/vooluvesi"),t||(t=await fetch("/geojson/vooluvesi"),e.put("/geojson/vooluvesi",t.clone())),a=await t.json(),N.value="Laen karstij채rvikud...",R=a,t=await e.match("/geojson/karst"),t||(t=await fetch("/geojson/karst"),e.put("/geojson/karst",t.clone())),a=await t.json(),Y=a,de.value=!0,y.value=!0;const i=p.value.leafletObject;$=m.geoJSON(q,{style:ce,onEachFeature:M}),h=m.geoJSON(R,{style:Z,onEachFeature:M}),C=m.geoJSON(Y,{style:ue,onEachFeature:M}),c.value=localStorage.getItem("isJarvedVisible")==="true"||!1,u.value=localStorage.getItem("isVooluvesiVisible")==="true"||!1,d.value=localStorage.getItem("isKarstVisible")==="true"||!1,c.value&&$.addTo(i),u.value&&h.addTo(i),d.value&&C.addTo(i)}),navigator.geolocation&&g.main_map&&navigator.geolocation.getCurrentPosition(e=>{let t=J(e.coords.latitude,e.coords.longitude);W.contains(t)&&(T=t,v.value=9)},e=>{console.error("Error obtaining geolocation: ",e)}),_([se,v],([e,t])=>{p.value&&(p.value={center:e,zoom:t})}),_(v,()=>{h&&h.setStyle(Z)}),_(c,e=>{e?$.addTo(n):n.removeLayer($)}),_(u,e=>{e?h.addTo(n):n.removeLayer(h)}),_(d,e=>{e?C.addTo(n):n.removeLayer(C)}),(e,t)=>(b(),A(je,{title:e.$t("Main map")},{header:j(()=>[o("h2",Ve,L(e.$t(w.title)),1)]),default:j(()=>[o("main",Me,[s(y)?ke("",!0):(b(),V("div",Te,[o("div",Ae,[o("div",Ie,[o("div",ze,[o("span",Ue,[k(Be,{class:"w-20 mt-4 h-20 fill-white"})])]),Je]),De,o("p",Pe,L(s(N)),1)])])),o("div",Ze,[o("div",Fe,[o("label",Ke,[Ge,I(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=a=>B(c)?c.value=a:c=a)},null,512),[[z,s(c)]])]),o("label",qe,[Re,I(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>B(u)?u.value=a:u=a)},null,512),[[z,s(u)]])]),o("label",Ye,[We,I(o("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>B(d)?d.value=a:d=a)},null,512),[[z,s(d)]])]),o("button",{class:"btn btn-accent",onClick:ne},Qe)])]),k(s(xe),{ref_key:"map",ref:p,crs:s(he),zoom:v.value,"onUpdate:zoom":t[3]||(t[3]=a=>v.value=a),useGlobalLeaflet:!0,center:s(T),bounds:s(me),maxZoom:14,minZoom:3,scrollWheelZoom:!0,onClick:ve,onReady:pe},{default:j(()=>[k(s(te),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/vreljeef/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",tms:s(F),"full-screen":!1,worldCopyJump:!0,"z-index":1,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),k(s(te),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/hybriid/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",attribution:"Maa-ameti kaart, <a href='http://www.maaamet.ee'>Maa-amet</a>",tms:s(F),"full-screen":!1,worldCopyJump:!0,"z-index":2,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),(b(!0),V(X,null,Q(s(K),(a,i)=>(b(),A(s(oe),{key:i,"lat-lng":a},{default:j(()=>[k(s(Se),{ref_for:!0,ref:"popup"},{default:j(()=>[ae(" Popup content ")]),_:1},512)]),_:2},1032,["lat-lng"]))),128)),(b(!0),V(X,null,Q(s(g).observation_spots,(a,i)=>(b(),A(s(oe),{key:i,"lat-lng":[a.latitude,a.longitude],icon:s(G),onClick:O=>fe(a)},null,8,["lat-lng","icon","onClick"]))),128))]),_:1},8,["crs","zoom","center","bounds"]),k(Oe,{showModal:s(x),selectedAreaName:s(P),"onUpdate:showModal":t[4]||(t[4]=a=>B(x)?x.value=a:x=a)},null,8,["showModal","selectedAreaName"]),o("div",{class:D(["modal",{"modal-open":s(E)}])},[o("div",{class:"modal-box"},[Xe,o("div",{class:"modal-action"},[o("button",{class:"btn",onClick:ie}," Ok ")])])],2),o("div",{class:D(["modal",{"modal-open":s(S)}])},[o("div",et,[tt,o("div",ot,[o("button",{class:"btn",onClick:t[5]||(t[5]=a=>B(S)?S.value=!1:S=!1)}," Ok ")])])],2)])]),_:1},8,["title"]))}};export{it as default};
