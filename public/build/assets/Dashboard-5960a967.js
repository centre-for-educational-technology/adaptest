import{o as b,e as $,a as t,g as X,t as B,n as U,d as n,p as q,q as be,c as V,w as x,u as a,b as i,f as fe,l as M,v as O,s as j,h as R,F as Y,x as v,m as ge,O as A}from"./app-c09559af.js";import{t as z,a as W,l as _,m as he,v as H,n as I,i as _e,u as Q,y as ye}from"./pin-d3dffac9.js";import{_ as we,a as ke}from"./AppLayout-90c3fc41.js";const xe={class:"modal-box"},je={class:"font-bold text-lg"},Be={class:"font-bold text-blue-500"},Se={class:"py-4"},Le={class:"modal-action"},Ee={__name:"LakeModal",props:{selectedAreaName:{type:String,required:!0},showModal:{type:Boolean,required:!0}},setup(y){return(f,m)=>(b(),$("div",{class:U(["modal",{"modal-open":y.showModal}])},[t("div",xe,[t("h3",je,[X(B(f.$t("You have chosen"))+" ",1),t("span",Be,B(y.selectedAreaName),1)]),t("p",Se,B(f.$t("Now set the marker of your observation by clicking on the map")),1),t("div",Le,[t("button",{class:"btn",onClick:m[0]||(m[0]=g=>f.$emit("update:showModal",!1))}," Ok ")])])],2))}},$e={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Ce={class:"relative",style:{height:"calc(100vh - 188px)",width:"100%"}},Ne={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-primary opacity-80 z-10"},Ve={class:"spinner z-50"},Me={class:"loader"},Oe={class:"loader-bg"},Ae={class:"flex items-center justify-center"},ze=t("div",{class:"drops"},[t("div",{class:"drop1"}),t("div",{class:"drop2"})],-1),Ie=t("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},[t("defs",null,[t("filter",{id:"liquid"},[t("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),t("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"liquid"})])])],-1),Ue={class:"text-white flex items-center justify-center text-2xl font-semibold"},Te={class:"checkbox-container"},De={class:"join space-x-1"},Pe={class:"label cursor-pointer"},Ze=t("span",{class:"label-text mr-1"},"J채rved",-1),Ke={class:"label cursor-pointer"},Je=t("span",{class:"label-text mr-1"},"Vooluveekogud",-1),Fe={class:"label cursor-pointer"},Ge=t("span",{class:"label-text mr-1"},"Karstij채rvikud",-1),qe=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})],-1),Re=[qe],Ye=t("h3",{class:"font-bold text-lg"},"Please select a water source first",-1),We={class:"modal-box"},He=t("h3",{class:"font-bold text-lg"},"You are outside of Estonia",-1),Qe={class:"modal-action"},st={__name:"Dashboard",props:{observation_spots:Object,title:String,main_map:Boolean},setup(y){const f=y,m=n(null),g=n(4),ee=n([55.615,-50.09]);n(!0),n(!0),n(!0),n(!1);let T=n(""),S=n(!1),w=n(!1),k=n(!1),r=n(!1),c=n(!1),u=n(!1);const te=()=>{localStorage.setItem("isJarvedVisible",r.value),localStorage.setItem("isVooluvesiVisible",c.value),localStorage.setItem("isKarstVisible",u.value)};q([r,c,u],()=>{te()});const oe=()=>{L.value="Laen geolokatsiooni...",h.value=!1,navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{let e=z(o.coords.latitude,o.coords.longitude);G.contains(e)?(N.value=e,g.value=9):k.value=!0,h.value=!0},o=>{console.error("Error obtaining geolocation: ",o),h.value=!0}):(console.error("Geolocation is not supported by this browser."),h.value=!0)};function se(){S.value=!S.value}function ae(o){return{fillColor:"blue",color:"white",weight:2,opacity:1,fillOpacity:.7}}function ne(o){return{fillColor:"red",color:"white",weight:2,opacity:1,fillOpacity:.7}}function le(o){return{fillColor:"green",color:"white",weight:2,opacity:1,fillOpacity:.7}}let ie=n(!1),l=null,h=n(!1);const C=(o,e)=>{e.on("click",()=>{l&&l.setStyle({weight:3,color:"#3388ff"}),T=o.properties.nimi,e.setStyle({weight:5,color:"red"}),w.value=!0,console.log("show modal"),l=e,s.openTooltip()});const s=e.bindTooltip(o.properties.nimi,{permanent:!1,direction:"center",className:"my-tooltip"})};let D=n(!0),N=z(58.789,24.554),re=W([60.4349,29.4338],[56.7458,20.373]),P=[],d=null;function ce(){console.log("map ready"),d=m.value.leafletObject}const Z=_.icon({iconUrl:he,iconSize:[55,55],iconAnchor:[25,55],popupAnchor:[0,-55],className:"marker-icon"});function ue(o){if(!l){S.value=!0;return}if(o.originalEvent.target.classList.contains("leaflet-interactive"))return;const e=o.latlng,s=_.marker(e,{icon:Z}),p=_.popup().setContent(`
      <p class="mb-2 text-lg font-semibold text-gray-900">${v("Add new observation spot?")}</p>
      <div class="flex space-x-2">
        <button id="yesButton" class="px-4 py-2 btn btn-primary">${v("Yes")}</button>
        <button id="noButton" class="px-4 py-2 btn">${v("No")}</button>
      </div>
    `);s.bindPopup(p),ge(()=>{d.invalidateSize(),d.addLayer(s),s.openPopup(),document.getElementById("yesButton").addEventListener("click",()=>{P.push(o.latlng),pe(o.latlng)}),document.getElementById("noButton").addEventListener("click",()=>{d.removeLayer(s),l&&(l.setStyle({weight:2,color:"#3388ff"}),l=null)}),d.on("popupclose",()=>{d.removeLayer(s)})})}function de(o){const e=`
      <h2 class="mb-2 text-lg font-semibold text-gray-900">${o.name}</h2>
      <p class="mb-2 text-md text-gray-900">${v("Add a new observation?")}</p>
      <div class="flex space-x-2">
          <div class="join">
            <button id="yesButton" class="px-4 py-2 btn join-item btn-primary">${v("Yes")}</button>
            <button id="noButton" class="px-4 py-2 btn join-item btn-error">${v("No")}</button>
           </div>
           <button id="viewButton" class="px-4 py-2 btn btn-secondary">${v("View")}</button>

      </div>
    `;_.popup().setLatLng([o.latitude,o.longitude]).setContent(e).openOn(d),document.getElementById("yesButton").addEventListener("click",()=>{me(o.id)}),document.getElementById("noButton").addEventListener("click",()=>{d.closePopup()}),document.getElementById("viewButton").addEventListener("click",()=>{A.get(`/observation-spots/${o.id}`)})}function pe(o){if(console.log("add new spot and observation"),l){const e=JSON.stringify(o),s=l.feature.properties.nimi,p=l.feature.properties.kr_kood,E=null;A.get(`/observations/create?coordinates=${e}&name=${s}&water_body_kr_code=${p}&observation_spot_id=${E}`)}}function me(o){console.log("add new observation"),A.get(`/observations/create?observation_spot_id=${o}`)}var K=null,J=null,F=null;let L=n("Laen j채rved...");var ve=new _.Proj.CRS("EPSG:3301","+proj=lcc +lat_1=59.33333333333334 +lat_2=58 +lat_0=57.51755393055556 +lon_0=24 +x_0=500000 +y_0=6375000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",{resolutions:[4e3,2e3,1e3,500,250,125,62.5,31.25,15.625,7.8125,3.90625,1.953125,.9765625,.48828125,.244140625,.122070313,.061035156,.030517578,.015258789],origin:[40500,5993e3],bounds:_.bounds([40500,5993e3],[1064500,7017e3])});let G=W([57.522,21.77],[59.674,28.209]);return be(async()=>{const o=await caches.open("geojson-cache");let e=await o.match("/geojson/jarved");e||(e=await fetch("/geojson/jarved"),o.put("/geojson/jarved",e.clone()));let s=await e.json();L.value="Laen vooluveekogud...",K=s,e=await o.match("/geojson/vooluvesi"),e||(e=await fetch("/geojson/vooluvesi"),o.put("/geojson/vooluvesi",e.clone())),s=await e.json(),L.value="Laen karstij채rvikud...",J=s,e=await o.match("/geojson/karst"),e||(e=await fetch("/geojson/karst"),o.put("/geojson/karst",e.clone())),s=await e.json(),F=s,ie.value=!0,h.value=!0,r.value=localStorage.getItem("isJarvedVisible")==="true"||!1,c.value=localStorage.getItem("isVooluvesiVisible")==="true"||!1,u.value=localStorage.getItem("isKarstVisible")==="true"||!1}),navigator.geolocation&&f.main_map&&navigator.geolocation.getCurrentPosition(o=>{let e=z(o.coords.latitude,o.coords.longitude);G.contains(e)&&(N=e,g.value=9)},o=>{console.error("Error obtaining geolocation: ",o)}),q([ee,g],([o,e])=>{m.value&&(m.value={center:o,zoom:e})}),(o,e)=>(b(),V(we,{title:o.$t("Main map")},{header:x(()=>[t("h2",$e,B(o.$t(y.title)),1)]),default:x(()=>[t("main",Ce,[a(h)?fe("",!0):(b(),$("div",Ne,[t("div",Ve,[t("div",Me,[t("div",Oe,[t("span",Ae,[i(ke,{class:"w-20 mt-4 h-20 fill-white"})])]),ze]),Ie,t("p",Ue,B(a(L)),1)])])),t("div",Te,[t("div",De,[t("label",Pe,[Ze,M(t("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>j(r)?r.value=s:r=s)},null,512),[[O,a(r)]])]),t("label",Ke,[Je,M(t("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>j(c)?c.value=s:c=s)},null,512),[[O,a(c)]])]),t("label",Fe,[Ge,M(t("input",{class:"checkbox checkbox-lg",type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>j(u)?u.value=s:u=s)},null,512),[[O,a(u)]])]),t("button",{class:"btn btn-accent",onClick:oe},Re)])]),i(a(_e),{ref_key:"map",ref:m,crs:a(ve),zoom:g.value,"onUpdate:zoom":e[3]||(e[3]=s=>g.value=s),useGlobalLeaflet:!0,center:a(N),bounds:a(re),maxZoom:14,minZoom:3,scrollWheelZoom:!0,onClick:ue,onReady:ce},{default:x(()=>[i(a(H),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/vreljeef/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",tms:a(D),"full-screen":!1,worldCopyJump:!0,"z-index":1,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(a(H),{url:"https://tiles.maaamet.ee/tm/tms/1.0.0/hybriid/{z}/{x}/{y}.png&ASUTUS=TLU&KESKKOND=ADAPTEST",attribution:"Maa-ameti kaart, <a href='http://www.maaamet.ee'>Maa-amet</a>",tms:a(D),"full-screen":!1,worldCopyJump:!0,"z-index":2,options:{maxNativeZoom:13,maxZoom:13,minZoom:3}},null,8,["tms"]),i(a(I),{visible:a(r),options:{style:ae,onEachFeature:C},geojson:a(K)},null,8,["visible","options","geojson"]),i(a(I),{visible:a(c),options:{style:ne,onEachFeature:C},geojson:a(J)},null,8,["visible","options","geojson"]),i(a(I),{visible:a(u),options:{style:le,onEachFeature:C},geojson:a(F)},null,8,["visible","options","geojson"]),(b(!0),$(Y,null,R(a(P),(s,p)=>(b(),V(a(Q),{key:p,"lat-lng":s},{default:x(()=>[i(a(ye),{ref_for:!0,ref:"popup"},{default:x(()=>[X(" Popup content ")]),_:1},512)]),_:2},1032,["lat-lng"]))),128)),(b(!0),$(Y,null,R(a(f).observation_spots.data,(s,p)=>(b(),V(a(Q),{key:p,"lat-lng":[s.latitude,s.longitude],icon:a(Z),onClick:E=>de(s)},null,8,["lat-lng","icon","onClick"]))),128))]),_:1},8,["crs","zoom","center","bounds"]),i(Ee,{showModal:a(w),selectedAreaName:a(T),"onUpdate:showModal":e[4]||(e[4]=s=>j(w)?w.value=s:w=s)},null,8,["showModal","selectedAreaName"]),t("div",{class:U(["modal",{"modal-open":a(S)}])},[t("div",{class:"modal-box"},[Ye,t("div",{class:"modal-action"},[t("button",{class:"btn",onClick:se}," Ok ")])])],2),t("div",{class:U(["modal",{"modal-open":a(k)}])},[t("div",We,[He,t("div",Qe,[t("button",{class:"btn",onClick:e[5]||(e[5]=s=>j(k)?k.value=!1:k=!1)}," Ok ")])])],2)])]),_:1},8,["title"]))}};export{st as default};
